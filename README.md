# Group-17-Inter-Layer-Scheduling-In-Krittika
In this project, we integrated an optimal hardware tile scheduling algorithm into the Krittika framework to improve scheduling of DNN architectures.

Guidelines for Krittika-SET Integration

1) Create a new directory, say HML_project. This directory will contain all the relevant frameworks/simulators like Krittika, SCALE-Sim and SET.
2) Install Krittika (and SCALE-sim) repo inside HML_project, as outlined in https://github.com/scalesim-project/krittika/blob/main/README.md (Section: Installing the package)
3) Install SET_artifact from https://doi.org/10.5281/zenodo.7751328 into HML_project. No need to do any setup inside this folder.

- Running SET from Krittika

In the HML_project/krittika directory, run:
python3 SET_run.py -c <SET_config_file> -j <SET_json_file>

a) The SET_run.py script runs the SET framework (creates a build and runs it) with the SET_config_file. It generates the SET output text file,  SET/intermediate_results/SET_output.txt and converts it into a JSON which is saved by user as indicated by command line "-j".
b) SET_config_file: SET/config/SET_Resnet50_cfg.txt (Path to the configuration file for the SET framework)
	The SET_config_file looks like this:
		seed 1667996123
		mapper 0
		net 2
		xLen 4
		yLen 4
		stride 1
		batch 1
		runLP 1
		runLS 1
		costFunc 0
		roundFactor 100
		
	The description of parameters is as follows:
		seed : the random seed used inside SET for SA algorithm (No need to change)
		net : the DNN workload (2 => ResNet-50, which is currently simulated. The Krittika-SET integrated framework can also support 0 => Darknet19 and 1 => vgg19)
		batch : the number of samples in one batch
		mapper : the core type of the tile (0 => Simba, ie, weight-stationary is implemented for now in Krittika-SET integrated framework)
		xLen , yLen : the size of the tile mesh (4,4 for 16 core simulation)
		stride : the stride used in placement
		costFunc : controls the cost function (should be kept 0, for delay-based optimization)
		roundFactor : controls the number of rounds in the SA algorithm (keep as 100)
		runLS , runLP : whether run LS / LP experiments or not (in addition to SET)
		
c) SET_json_file: Path to save the JSON output results file, to be used for launching Krittika run

- Launching Krittika run

Refer 'Launching a run' section at https://github.com/scalesim-project/krittika/blob/main/README.md

In the HML_project/krittika directory, run:
python3 krittika/krittika-sim.py -c <config_file> -t <topology_file> -j <SET_json_file>
a) Inside the HML_project/krittika directory, run "export PYTHONPATH=." [Especially if facing 'No module name Krittika' error]
b) config_file: configs/SET_RA_Tree.cfg
c) topology_file: topologies/resnet50_7_layers.csv [we have simulated for the first 7 layers, but provided topology files for 24 and All layers too]
d) SET_json_file: path to json file generated by running SET, user input while running SET from Krittika

- Obtaining latency results

In the HML_project/krittika directory, run:
python3 krittika/calculate_total_cycles.py -c <compute_report> -j <SET_json_file>
a) compute_report: Path to the compute report csv file generated from Krittika run.
b) SET_json_file: Path to json file generated by running the SET Framework in Step 1.
The total cycles calculated for the entire model according to the given scheduling will be displayed in the terminal window.


- Key changes made to Krittika
1) SIMD maxpool:
	a) How to define in topology file: "activation,maxpool,<pooling width>,<pooling height>,<Number of channels of the output>,<pooling stride>
	b) Implementation in <FILENAME>: TODO
2) SIMD adde: 
	a) How to define in topology file: "activation, adde"
	b) Implementation similar to relu.
3) New partition mode - SET_RA_TREE - having constant dataflow (Weight-Stationary), and input_part and filter_part determined from SET_json_file.
4) New command line argument: -j <SET_json_file>, to enable Krittika-SET integration.
